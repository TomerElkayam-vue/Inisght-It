generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["prismaSchemaFolder"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username           String              @unique
  password           String              @db.Text
  firstName          String              @map("first_name")
  lastName           String              @map("last_name")
  createdAt          DateTime            @default(now()) @map("created_at")
  projectPermissions ProjectPermission[]

  @@map("users")
}

model Project {
  id                           String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                         String
  codeRepositoryCredentials    Json?               @map("code_repository_credentials")
  missionManagementCredentials Json?               @map("mission_management_credentials")
  statistics                   Json?
  recommendations              Json?
  createdAt                    DateTime            @default(now())
  projectPermissions           ProjectPermission[]
  employees                    ProjectEmployee[]

  @@map("projects")
}

model Role {
  id                 Int                 @id
  name               String              @unique
  createdAt          DateTime            @default(now()) @map("created_at")
  projectPermissions ProjectPermission[]

  @@map("roles")
}

model ProjectPermission {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  projectId String   @db.Uuid
  roleId    Int
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  role    Role    @relation(fields: [roleId], references: [id])

  @@unique([userId, projectId])
  @@map("project_permissions")
}

model Employee {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  displayName   String           @map("display_name")
  githubUsername String?         @map("github_username")
  jiraUsername  String?          @map("jira_username")
  projects      ProjectEmployee[]

  @@map("employee")
}

model ProjectEmployee {
  projectId    String   @db.Uuid @map("project_id")
  employeeId   String   @db.Uuid @map("employee_id")
  project      Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@id([employeeId, projectId])
  @@map("project_employee")
}
